# Configura√ß√µes de Notifica√ß√µes - Sistema Prisma
# Define canais e regras para notifica√ß√µes do sistema

metadata:
  versao: '1.0.0'
  ultima_atualizacao: '2025-11-02'
  status: 'Ativo'

# Canais de Notifica√ß√£o
canais:
  slack:
    habilitado: false

    # Configura√ß√£o
    webhook_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'
    canal_padrao: '#prisma-notifications'

    # Canais espec√≠ficos por tipo
    canais_especificos:
      erro: '#prisma-errors'
      sucesso: '#prisma-success'
      quality_gate: '#prisma-quality'
      deploy: '#prisma-deploys'

    # Formata√ß√£o
    formatacao:
      usar_blocos: true
      usar_emojis: true
      mencionar_usuario: true

    # Prioridade
    enviar_para:
      - fase_concluida
      - quality_gate_falhou
      - erro_critico

  discord:
    habilitado: false

    # Configura√ß√£o
    webhook_url: 'https://discord.com/api/webhooks/YOUR/WEBHOOK'
    servidor: 'Prisma Dev Team'

    # Canais espec√≠ficos
    canais_especificos:
      geral: 'prisma-general'
      alertas: 'prisma-alerts'
      sucesso: 'prisma-success'

    # Formata√ß√£o
    formatacao:
      usar_embeds: true
      cor_sucesso: '#00ff00'
      cor_erro: '#ff0000'
      cor_aviso: '#ffff00'

    # Prioridade
    enviar_para:
      - fase_concluida
      - implementacao_concluida
      - testes_falharam

  email:
    habilitado: false

    # SMTP Config
    smtp:
      host: 'smtp.gmail.com'
      port: 587
      secure: true
      auth:
        # Usar vari√°veis de ambiente
        user: 'EMAIL_USER'
        pass: 'EMAIL_PASSWORD'

    # Destinat√°rios
    destinatarios:
      admin: ['admin@example.com']
      equipe: ['team@example.com']
      stakeholders: ['stakeholder@example.com']

    # Templates
    templates:
      usar_html: true
      incluir_logo: true
      incluir_links: true

    # Prioridade
    enviar_para:
      - erro_critico
      - quality_gate_falhou
      - deploy_producao

  telegram:
    habilitado: false

    # Bot Config
    bot_token: 'TELEGRAM_BOT_TOKEN'
    chat_ids:
      equipe: '-1001234567890'
      alertas: '-1001234567891'

    # Formata√ß√£o
    formatacao:
      parse_mode: 'Markdown'
      disable_notification: false

  in_app:
    habilitado: true

    # Notifica√ß√µes no VSCode
    vscode:
      usar_notifications: true
      usar_status_bar: true
      dura√ß√£o_ms: 5000

    # Tipos de notifica√ß√£o
    tipos:
      info: true
      warning: true
      error: true
      success: true

# Eventos que Geram Notifica√ß√µes
eventos:
  fase_iniciada:
    habilitado: true
    prioridade: 'baixa'
    canais: ['in_app']
    template: |
      üìã Fase iniciada: {fase}
      Feature: {feature_name}

  fase_concluida:
    habilitado: true
    prioridade: 'media'
    canais: ['in_app', 'slack', 'discord']
    template: |
      ‚úÖ Fase conclu√≠da: {fase}
      Feature: {feature_name}
      Quality Score: {quality_score}/10

  quality_gate_passou:
    habilitado: true
    prioridade: 'media'
    canais: ['in_app']
    template: |
      ‚úÖ Quality Gate aprovado
      Gate: {gate_name}
      Score: {score}

  quality_gate_falhou:
    habilitado: true
    prioridade: 'alta'
    canais: ['in_app', 'slack', 'discord', 'email']
    template: |
      ‚ùå Quality Gate falhou
      Gate: {gate_name}
      Feature: {feature_name}
      Detalhes: {detalhes}

  implementacao_iniciada:
    habilitado: true
    prioridade: 'baixa'
    canais: ['in_app']
    template: |
      üî® Implementa√ß√£o iniciada
      Task: {task_name}

  implementacao_concluida:
    habilitado: true
    prioridade: 'media'
    canais: ['in_app', 'slack', 'discord']
    template: |
      ‚úÖ Implementa√ß√£o conclu√≠da
      Task: {task_name}
      Files changed: {files_changed}

  testes_executados:
    habilitado: true
    prioridade: 'media'
    canais: ['in_app']
    template: |
      üß™ Testes executados
      Passou: {passou}
      Cobertura: {cobertura}%
      Falhas: {falhas}

  testes_falharam:
    habilitado: true
    prioridade: 'alta'
    canais: ['in_app', 'slack', 'discord']
    template: |
      ‚ùå Testes falharam
      Feature: {feature_name}
      Falhas: {total_falhas}
      Detalhes: {detalhes}

  risco_identificado:
    habilitado: true
    prioridade: 'alta'
    canais: ['in_app', 'slack', 'email']
    condicoes:
      nivel_minimo: 'alto'
    template: |
      ‚ö†Ô∏è Risco identificado
      N√≠vel: {nivel}
      Categoria: {categoria}
      Descri√ß√£o: {descricao}

  erro_critico:
    habilitado: true
    prioridade: 'critica'
    canais: ['in_app', 'slack', 'discord', 'email', 'telegram']
    template: |
      üö® ERRO CR√çTICO
      Agente: {agente}
      Erro: {mensagem}
      Stack: {stack_trace}

  deploy_producao:
    habilitado: true
    prioridade: 'alta'
    canais: ['slack', 'discord', 'email']
    template: |
      üöÄ Deploy em produ√ß√£o
      Feature: {feature_name}
      Vers√£o: {versao}
      Ambiente: {ambiente}

# Regras de Agrupamento
agrupamento:
  habilitado: true

  # Agrupar notifica√ß√µes similares
  janela_tempo_segundos: 60

  # M√°ximo de notifica√ß√µes antes de agrupar
  max_antes_agrupar: 3

  # Template de agrupamento
  template_agrupado: |
    üì¶ {count} notifica√ß√µes agrupadas
    Tipo: {tipo}
    √öltima: {ultima_notificacao}

# Silenciamento
silenciamento:
  habilitado: true

  # Hor√°rios de sil√™ncio
  horarios:
    noturno:
      habilitado: true
      inicio: '22:00'
      fim: '08:00'
      timezone: 'America/Sao_Paulo'
      exce√ß√µes: ['erro_critico']

    fim_de_semana:
      habilitado: true
      dias: ['sabado', 'domingo']
      exce√ß√µes: ['erro_critico', 'deploy_producao']

  # Silenciar por tipo
  tipos_silenciados: []

  # Silenciar por feature
  features_silenciadas: []

# Prioridades
prioridades:
  critica:
    cor: '#FF0000'
    som: true
    persistente: true
    enviar_todos_canais: true

  alta:
    cor: '#FF6600'
    som: true
    persistente: false
    enviar_todos_canais: false

  media:
    cor: '#FFFF00'
    som: false
    persistente: false

  baixa:
    cor: '#00FF00'
    som: false
    persistente: false

# Rate Limiting
rate_limiting:
  habilitado: true

  # M√°ximo de notifica√ß√µes por minuto
  max_por_minuto: 10

  # M√°ximo de notifica√ß√µes por hora
  max_por_hora: 50

  # A√ß√£o ao atingir limite
  acao: 'agrupar'  # ou 'descartar', 'enfileirar'

# Retry Policy
retry:
  habilitado: true
  max_tentativas: 3
  delay_ms: 1000
  backoff: 'exponential'

# Analytics
analytics:
  habilitado: true

  # M√©tricas coletadas
  metricas:
    - total_notificacoes
    - notificacoes_por_canal
    - notificacoes_por_prioridade
    - taxa_entrega
    - taxa_erro

  # Armazenamento
  armazenar_historico: true
  dias_retencao: 30
