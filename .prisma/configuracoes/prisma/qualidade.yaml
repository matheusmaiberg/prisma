# Configurações de Qualidade - Sistema Prisma
# Define quality gates, métricas e thresholds para validação

metadata:
  versao: '1.0.0'
  ultima_atualizacao: '2025-11-02'
  status: 'Ativo'

# Revisão de Código
revisao_codigo:
  habilitado: true
  agente: 'revisor'
  requer_aprovacao: true

  # Métricas de Qualidade
  metricas:
    pontuacao_minima: 7.0
    pontuacao_maxima: 10.0
    problemas_seguranca_criticos: 0
    problemas_seguranca_altos: 0

  # Categorias de Avaliação
  categorias:
    - nome: 'Arquitetura'
      peso: 20
    - nome: 'Qualidade do Código'
      peso: 25
    - nome: 'Segurança'
      peso: 25
    - nome: 'Testabilidade'
      peso: 15
    - nome: 'Manutenibilidade'
      peso: 15

# Conformidade com Padrões
conformidade:
  habilitado: true
  agente: 'conformista'
  requer_aprovacao: true

  # Thresholds
  percentual_minimo: 95
  threshold_bloqueio: 70
  threshold_aviso: 85

  # Validações
  validacoes:
    - tipo: 'naming-conventions'
      descricao: 'Verificar convenções de nomenclatura'
      bloqueante: true

    - tipo: 'file-structure'
      descricao: 'Validar estrutura de arquivos e pastas'
      bloqueante: true

    - tipo: 'documentation'
      descricao: 'Validar presença de documentação'
      bloqueante: false

    - tipo: 'specs-alignment'
      descricao: 'Validar alinhamento com especificações'
      bloqueante: true

# Testes Automatizados
testes:
  habilitado: true
  agente: 'testador-specs'
  requer_cobertura: true

  # Métricas de Cobertura
  cobertura:
    linha_minima: 80
    branch_minima: 75
    funcao_minima: 80
    statement_minima: 80

  # Tipos de Teste
  tipos:
    - nome: 'unit'
      habilitado: true
      obrigatorio: true

    - nome: 'integration'
      habilitado: true
      obrigatorio: true

    - nome: 'e2e'
      habilitado: true
      obrigatorio: false

  # Test Trophy (priorização)
  test_trophy:
    habilitado: true
    distribuicao:
      unit: 70          # 70% unit tests
      integration: 20   # 20% integration tests
      e2e: 10          # 10% e2e tests

# Quality Gates por Fase
quality_gates:
  requisitos:
    - nome: 'EARS Format'
      descricao: 'Requisitos seguem formato EARS'
      bloqueante: true

    - nome: 'User Stories'
      descricao: 'Todas user stories têm acceptance criteria'
      bloqueante: true

  design:
    - nome: 'Architecture Decision'
      descricao: 'Decisões arquiteturais documentadas'
      bloqueante: false

    - nome: 'Diagramas'
      descricao: 'Pelo menos um diagrama Mermaid presente'
      bloqueante: false

    - nome: 'Tech Stack Alignment'
      descricao: 'Design alinhado com stack tecnológica'
      bloqueante: true

  tarefas:
    - nome: 'Task Breakdown'
      descricao: 'Todas tarefas são atômicas e executáveis'
      bloqueante: true

    - nome: 'Requirements Coverage'
      descricao: 'Todas requirements têm tasks correspondentes'
      bloqueante: true

    - nome: 'Dependencies'
      descricao: 'Dependências entre tasks identificadas'
      bloqueante: false

  implementacao:
    - nome: 'Code Quality'
      descricao: 'Score >= 7/10 na revisão de código'
      bloqueante: true

    - nome: 'Security Issues'
      descricao: 'Zero problemas críticos/altos de segurança'
      bloqueante: true

    - nome: 'Test Coverage'
      descricao: 'Cobertura >= 80%'
      bloqueante: true

    - nome: 'Standards Compliance'
      descricao: 'Conformidade >= 95%'
      bloqueante: true

# Análise de Riscos
riscos:
  habilitado: true
  agente: 'avaliador-riscos'

  # Categorias de Risco
  categorias:
    - nome: 'Técnico'
      peso: 30

    - nome: 'Arquitetural'
      peso: 25

    - nome: 'Segurança'
      peso: 25

    - nome: 'Negócio'
      peso: 20

  # Níveis de Risco
  niveis:
    baixo:
      threshold: 3
      acao: 'documentar'

    medio:
      threshold: 6
      acao: 'mitigar'

    alto:
      threshold: 8
      acao: 'bloquear_ou_redesenhar'

    critico:
      threshold: 10
      acao: 'bloquear_imediatamente'

# Auditoria
auditoria:
  habilitado: true
  agente: 'auditor'

  # Escopo
  escopo:
    - 'codigo'
    - 'especificacoes'
    - 'testes'
    - 'documentacao'

  # Frequência
  frequencia: 'por_demanda'  # ou 'automatica', 'periodica'
