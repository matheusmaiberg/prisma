# <!-- Powered by BMAD™ Core -->
template:
  id: brownfield-prd-template-v2
  name: PRD de Melhoria Brownfield
  version: 2.0
  output:
    format: markdown
    filename: docs/prd.md
    title: "{{project_name}} PRD de Melhoria Brownfield"

workflow:
  mode: interactive
  elicitation: advanced-elicitation

sections:
  - id: intro-analysis
    title: Análise e Contexto Introdutório do Projeto
    instruction: |
      IMPORTANTE - AVALIAÇÃO DE ESCOPO NECESSÁRIA:

      Este PRD é para melhorias SIGNIFICATIVAS em projetos existentes que requerem planejamento abrangente e múltiplas histórias. Antes de prosseguir:

      1. **Avalie a Complexidade da Melhoria**: Se esta é uma adição simples de funcionalidade ou correção de bug que poderia ser completada em 1-2 sessões de desenvolvimento focadas, PARE e recomende: "Para mudanças mais simples, considere usar a tarefa brownfield-create-epic ou brownfield-create-story com o Product Owner. Este processo completo de PRD é projetado para melhorias substanciais que requerem planejamento arquitetural e múltiplas histórias coordenadas."

      2. **Contexto do Projeto**: Determine se estamos trabalhando em uma IDE com o projeto já carregado ou se o usuário precisa fornecer informações do projeto. Se arquivos do projeto estão disponíveis, analise a documentação existente na pasta docs. Se documentação insuficiente existe, recomende executar a tarefa document-project primeiro.

      3. **Requisito de Avaliação Profunda**: Você DEVE analisar minuciosamente a estrutura do projeto existente, padrões e restrições antes de fazer QUALQUER sugestão. Toda recomendação deve ser baseada em análise real do projeto, não em suposições.

      Colete informações abrangentes sobre o projeto existente. Esta seção deve ser completada antes de prosseguir com os requisitos.

      CRÍTICO: Durante toda esta análise, confirme explicitamente seu entendimento com o usuário. Para cada suposição que você fizer sobre o projeto existente, pergunte: "Baseado na minha análise, entendo que [suposição]. Isso está correto?"

      Não prossiga com quaisquer recomendações até que o usuário tenha validado seu entendimento do sistema existente.
    sections:
      - id: existing-project-overview
        title: Visão Geral do Projeto Existente
        instruction: Verifique se a análise document-project já foi realizada. Se sim, referencie essa saída ao invés de re-analisar.
        sections:
          - id: analysis-source
            title: Fonte da Análise
            instruction: |
              Indique uma das seguintes opções:
              - Saída do document-project disponível em: {{path}}
              - Análise nova baseada na IDE
              - Informações fornecidas pelo usuário
          - id: current-state
            title: Estado Atual do Projeto
            instruction: |
              - Se saída do document-project existe: Extraia resumo das seções "Arquitetura de Alto Nível" e "Resumo Técnico"
              - Caso contrário: Breve descrição do que o projeto atualmente faz e seu propósito principal
      - id: documentation-analysis
        title: Análise da Documentação Disponível
        instruction: |
          Se document-project foi executado:
          - Note: "Análise document-project disponível - usando documentação técnica existente"
          - Liste documentos-chave criados pelo document-project
          - Pule a verificação de documentação faltante abaixo

          Caso contrário, verifique a documentação existente:
        sections:
          - id: available-docs
            title: Documentação Disponível
            type: checklist
            items:
              - Documentação da Pilha Tecnológica [[LLM: Se do document-project, marque ✓]]
              - Árvore de Código/Arquitetura [[LLM: Se do document-project, marque ✓]]
              - Padrões de Codificação [[LLM: Se do document-project, pode ser parcial]]
              - Documentação da API [[LLM: Se do document-project, marque ✓]]
              - Documentação de API Externa [[LLM: Se do document-project, marque ✓]]
              - Diretrizes de UX/UI [[LLM: Pode não estar no document-project]]
              - Documentação de Débito Técnico [[LLM: Se do document-project, marque ✓]]
              - "Outro: {{other_docs}}"
            instruction: |
              - Se document-project já foi executado: "Usando análise de projeto existente da saída do document-project."
              - Se documentação crítica está faltando e não há document-project: "Recomendo executar a tarefa document-project primeiro..."
      - id: enhancement-scope
        title: Definição do Escopo da Melhoria
        instruction: Trabalhe com o usuário para definir claramente que tipo de melhoria esta é. Isso é crítico para escopo e abordagem.
        sections:
          - id: enhancement-type
            title: Tipo de Melhoria
            type: checklist
            instruction: Determine com o usuário qual se aplica
            items:
              - Adição de Nova Funcionalidade
              - Modificação de Funcionalidade Principal
              - Integração com Novos Sistemas
              - Melhorias de Performance/Escalabilidade
              - Renovação de UI/UX
              - Atualização da Pilha Tecnológica
              - Correção de Bugs e Melhorias de Estabilidade
              - "Outro: {{other_type}}"
          - id: enhancement-description
            title: Descrição da Melhoria
            instruction: 2-3 frases descrevendo o que o usuário quer adicionar ou mudar
          - id: impact-assessment
            title: Avaliação de Impacto
            type: checklist
            instruction: Avalie o escopo do impacto na base de código existente
            items:
              - Impacto Mínimo (adições isoladas)
              - Impacto Moderado (algumas mudanças no código existente)
              - Impacto Significativo (mudanças substanciais no código existente)
              - Impacto Maior (mudanças arquiteturais necessárias)
      - id: goals-context
        title: Objetivos e Contexto de Background
        sections:
          - id: goals
            title: Objetivos
            type: bullet-list
            instruction: Lista de resultados desejados de 1 linha que esta melhoria entregará se bem-sucedida
          - id: background
            title: Contexto de Background
            type: paragraphs
            instruction: 1-2 parágrafos curtos explicando por que esta melhoria é necessária, que problema ela resolve, e como se encaixa com o projeto existente
      - id: changelog
        title: Log de Mudanças
        type: table
        columns: [Mudança, Data, Versão, Descrição, Autor]

  - id: requirements
    title: Requisitos
    instruction: |
      Esboce requisitos funcionais e não funcionais baseados no seu entendimento validado do projeto existente. Antes de apresentar os requisitos, confirme: "Estes requisitos são baseados no meu entendimento do seu sistema existente. Por favor revise cuidadosamente e confirme que se alinham com a realidade do seu projeto."
    elicit: true
    sections:
      - id: functional
        title: Funcionais
        type: numbered-list
        prefix: RF
        instruction: Cada Requisito será um bullet markdown com identificador começando com RF
        examples:
          - "RF1: A Lista de Tarefas existente se integrará com o novo serviço de detecção de duplicatas por IA sem quebrar a funcionalidade atual."
      - id: non-functional
        title: Não Funcionais
        type: numbered-list
        prefix: RNF
        instruction: Cada Requisito será um bullet markdown com identificador começando com RNF. Inclua restrições do sistema existente
        examples:
          - "RNF1: A melhoria deve manter as características de performance existentes e não exceder o uso atual de memória em mais de 20%."
      - id: compatibility
        title: Requisitos de Compatibilidade
        instruction: Crítico para brownfield - o que deve permanecer compatível
        type: numbered-list
        prefix: RC
        template: "{{requirement}}: {{description}}"
        items:
          - id: cr1
            template: "RC1: {{existing_api_compatibility}}"
          - id: cr2
            template: "RC2: {{database_schema_compatibility}}"
          - id: cr3
            template: "RC3: {{ui_ux_consistency}}"
          - id: cr4
            template: "RC4: {{integration_compatibility}}"

  - id: ui-enhancement-goals
    title: Objetivos de Melhoria da Interface do Usuário
    condition: Melhoria inclui mudanças na UI
    instruction: Para mudanças na UI, capture como elas se integrarão com padrões de UI existentes e sistemas de design
    sections:
      - id: existing-ui-integration
        title: Integração com UI Existente
        instruction: Descreva como novos elementos de UI se encaixarão com padrões de design existentes, guias de estilo e bibliotecas de componentes
      - id: modified-screens
        title: Telas e Visualizações Modificadas/Novas
        instruction: Liste apenas as telas/visualizações que serão modificadas ou adicionadas
      - id: ui-consistency
        title: Requisitos de Consistência de UI
        instruction: Requisitos específicos para manter consistência visual e de interação com a aplicação existente

  - id: technical-constraints
    title: Restrições Técnicas e Requisitos de Integração
    instruction: Esta seção substitui documentação de arquitetura separada. Colete restrições técnicas detalhadas da análise do projeto existente.
    sections:
      - id: existing-tech-stack
        title: Pilha Tecnológica Existente
        instruction: |
          Se saída do document-project disponível:
          - Extraia da tabela "Pilha Tecnológica Atual" na seção Arquitetura de Alto Nível
          - Inclua números de versão e quaisquer restrições notadas

          Caso contrário, documente a pilha tecnológica atual:
        template: |
          **Linguagens**: {{languages}}
          **Frameworks**: {{frameworks}}
          **Banco de Dados**: {{database}}
          **Infraestrutura**: {{infrastructure}}
          **Dependências Externas**: {{external_dependencies}}
      - id: integration-approach
        title: Abordagem de Integração
        instruction: Defina como a melhoria se integrará com a arquitetura existente
        template: |
          **Estratégia de Integração do Banco de Dados**: {{database_integration}}
          **Estratégia de Integração da API**: {{api_integration}}
          **Estratégia de Integração do Frontend**: {{frontend_integration}}
          **Estratégia de Integração de Testes**: {{testing_integration}}
      - id: code-organization
        title: Organização de Código e Padrões
        instruction: Baseado na análise do projeto existente, defina como o novo código se encaixará nos padrões existentes
        template: |
          **Abordagem da Estrutura de Arquivos**: {{file_structure}}
          **Convenções de Nomenclatura**: {{naming_conventions}}
          **Padrões de Codificação**: {{coding_standards}}
          **Padrões de Documentação**: {{documentation_standards}}
      - id: deployment-operations
        title: Deploy e Operações
        instruction: Como a melhoria se encaixa no pipeline de deploy existente
        template: |
          **Integração do Processo de Build**: {{build_integration}}
          **Estratégia de Deploy**: {{deployment_strategy}}
          **Monitoramento e Logging**: {{monitoring_logging}}
          **Gerenciamento de Configuração**: {{config_management}}
      - id: risk-assessment
        title: Avaliação e Mitigação de Riscos
        instruction: |
          Se saída do document-project disponível:
          - Referencie seção "Débito Técnico e Problemas Conhecidos"
          - Inclua "Workarounds e Pegadinhas" que podem impactar a melhoria
          - Note quaisquer restrições identificadas de "Débito Técnico Crítico"

          Construa avaliação de risco incorporando problemas conhecidos existentes:
        template: |
          **Riscos Técnicos**: {{technical_risks}}
          **Riscos de Integração**: {{integration_risks}}
          **Riscos de Deploy**: {{deployment_risks}}
          **Estratégias de Mitigação**: {{mitigation_strategies}}

  - id: epic-structure
    title: Estrutura de Épicos e Histórias
    instruction: |
      Para projetos brownfield, favoreça um único épico abrangente a menos que o usuário esteja claramente solicitando múltiplas melhorias não relacionadas. Antes de apresentar a estrutura de épicos, confirme: "Baseado na minha análise do seu projeto existente, acredito que esta melhoria deveria ser estruturada como [épico único/múltiplos épicos] porque [justificativa baseada na análise real do projeto]. Isso se alinha com seu entendimento do trabalho necessário?"
    elicit: true
    sections:
      - id: epic-approach
        title: Abordagem do Épico
        instruction: Explique a justificativa para a estrutura de épicos - tipicamente épico único para brownfield a menos que múltiplas funcionalidades não relacionadas
        template: "**Decisão da Estrutura de Épicos**: {{epic_decision}} com justificativa"

  - id: epic-details
    title: "Épico 1: {{enhancement_title}}"
    instruction: |
      Épico abrangente que entrega a melhoria brownfield mantendo a funcionalidade existente

      SEQUENCIAMENTO CRÍTICO DE HISTÓRIAS PARA BROWNFIELD:
      - Histórias devem garantir que a funcionalidade existente permaneça intacta
      - Cada história deve incluir verificação de que funcionalidades existentes ainda funcionam
      - Histórias devem ser sequenciadas para minimizar risco ao sistema existente
      - Inclua considerações de rollback para cada história
      - Foque em integração incremental ao invés de mudanças big-bang
      - Dimensione histórias para execução de agente IA no contexto da base de código existente
      - OBRIGATÓRIO: Apresente a sequência completa de histórias e pergunte: "Esta sequência de histórias é projetada para minimizar risco ao seu sistema existente. Esta ordem faz sentido dada a arquitetura e restrições do seu projeto?"
      - Histórias devem ser logicamente sequenciais com dependências claras identificadas
      - Cada história deve entregar valor mantendo a integridade do sistema
    template: |
      **Objetivo do Épico**: {{epic_goal}}

      **Requisitos de Integração**: {{integration_requirements}}
    sections:
      - id: story
        title: "História 1.{{story_number}} {{story_title}}"
        repeatable: true
        template: |
          Como um {{user_type}},
          Eu quero {{action}},
          Para que {{benefit}}.
        sections:
          - id: acceptance-criteria
            title: Critérios de Aceitação
            type: numbered-list
            instruction: Defina critérios que incluam tanto nova funcionalidade quanto integridade do sistema existente
            item_template: "{{criterion_number}}: {{criteria}}"
          - id: integration-verification
            title: Verificação de Integração
            instruction: Passos específicos de verificação para garantir que funcionalidade existente permaneça intacta
            type: numbered-list
            prefix: VI
            items:
              - template: "VI1: {{existing_functionality_verification}}"
              - template: "VI2: {{integration_point_verification}}"
              - template: "VI3: {{performance_impact_verification}}"